{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile | CKW Cloud Kitchen</title>
    <link rel="stylesheet" href="{% static 'profile.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
</head>
<body>
  <div class="wrapper">
    <form method="post" enctype="multipart/form-data" class="profile-form">
      {% csrf_token %}
      <div class="img-area">
        <div class="inner-area">
          {% if user.profile_pic %}
            <img src="{{ user.profile_pic.url }}" alt="Profile Picture">
          {% else %}
            <img src="https://images.unsplash.com/photo-1492288991661-058aa541ff43?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=500&q=60" alt="Default Profile Picture">
          {% endif %}
        </div>
        <div class="upload-form">
          <input type="file" name="profile_pic" id="profile_pic" style="display: none;">
          <label for="profile_pic" class="upload-btn">
            <i class="fas fa-camera"></i>
          </label>
        </div>
      </div>
      <div class="icon arrow" onclick="window.history.back()"><i class="fas fa-arrow-left"></i></div>

      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" value="{{ user.email }}" required>
      </div>
      <div class="form-group">
        <label for="phone_number">Phone Number:</label>
        <input type="tel" id="phone_number" name="phone_number" value="{{ user.phone_number }}" required>
      </div>
      <div class="form-group">
        <label for="address">Address:</label>
        <input type="text" id="address" name="address" value="{{ user.address }}" maxlength="100" placeholder="Enter your full address" required>
      </div>
      <div class="buttons">
        <button type="submit">Update Profile</button>
        <button type="button" onclick="window.history.back()">Back</button>
      </div>
    </form>

    <div class="name">Hey !! {{ user.username }}</div>
  </div>

  <script>
    // Handle profile picture upload preview and auto-submit
    document.getElementById('profile_pic').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.querySelector('.inner-area img').src = e.target.result;
        };
        reader.readAsDataURL(file);
        // Auto-submit the form when profile picture is selected
        document.querySelector('.profile-form').submit();
      }
    });
  </script>
</body>
</html>
